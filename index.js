// Translations are embedded directly to avoid fetch() issues when running from file:// protocol
const translations = {
  "en": {
    "html_lang": "en",
    "title": "Troy Yachting — Yacht Manufacturing & Marine Services",
    "meta_description": "Troy Yachting offers luxury yacht manufacturing and comprehensive marine services. We are here to design and build the yacht of your dreams.",
    "og_description": "Luxury yacht manufacturing and comprehensive marine services.",
    "skip_link": "Skip to main content",
    "logo_aria": "Troy Yachting Homepage",
    "lang_select_label": "Select Language",
    "nav_about": "About Us",
    "nav_dreams": "Our Dreams",
    "nav_contact": "Contact Us",
    "card_manufacturing": "Yacht Manufacturing",
    "card_services": "Marine Services",
    "alt_manufacturing": "A luxury yacht in a manufacturing hangar.",
    "alt_services": "A modern yacht cruising at speed on the sea.",
    "section_about_title": "About Us",
    "section_about_content": "With years of experience in the maritime industry, Troy Yachting combines traditional craftsmanship with modern technology to create unparalleled yachts. Our passion for the sea and commitment to quality drive every project we undertake.",
    "section_dreams_title": "Our Dreams",
    "section_dreams_content": "We dream of pushing the boundaries of yacht design and engineering. Our goal is to build vessels that are not only luxurious and high-performing but also sustainable and in harmony with the ocean environment.",
    "section_contact_title": "Contact Us",
    "section_contact_content": "Ready to start your journey? Contact us to discuss your vision. We are excited to help you bring your dream yacht to life. Reach out via email at info@troyyachting.com or visit us at our shipyard.",
    "footer_copyright": "© 2025 Troy Yachting — all rights reserved."
  },
  "tr": {
    "html_lang": "tr",
    "title": "Troy Yachting — Yat Üretimi ve Denizcilik Hizmetleri",
    "meta_description": "Troy Yachting, lüks yat üretimi ve kapsamlı denizcilik hizmetleri sunar. Hayallerinizdeki yatı tasarlamak ve inşa etmek için buradayız.",
    "og_description": "Lüks yat üretimi ve kapsamlı denizcilik hizmetleri.",
    "skip_link": "Ana İçeriğe Geç",
    "logo_aria": "Troy Yachting Ana Sayfa",
    "lang_select_label": "Dil Seçin",
    "nav_about": "Hakkımızda",
    "nav_dreams": "Hayallerimiz",
    "nav_contact": "Bize Ulaşın",
    "card_manufacturing": "Yat Üretimi",
    "card_services": "Denizcilik Hizmetleri",
    "alt_manufacturing": "Üretim hangarında lüks bir yat.",
    "alt_services": "Denizde hızla ilerleyen modern bir yat.",
    "section_about_title": "Hakkımızda",
    "section_about_content": "Denizcilik sektöründeki yılların deneyimiyle Troy Yachting, geleneksel işçiliği modern teknolojiyle birleştirerek eşsiz yatlar yaratır. Deniz tutkumuz ve kaliteye olan bağlılığımız, üstlendiğimiz her projeye yön verir.",
    "section_dreams_title": "Hayallerimiz",
    "section_dreams_content": "Yat tasarımı ve mühendisliğinin sınırlarını zorlamayı hayal ediyoruz. Amacımız sadece lüks ve yüksek performanslı değil, aynı zamanda sürdürülebilir ve okyanus çevresiyle uyumlu tekneler inşa etmektir.",
    "section_contact_title": "Bize Ulaşın",
    "section_contact_content": "Yolculuğunuza başlamaya hazır mısınız? Vizyonunuzu görüşmek için bizimle iletişime geçin. Hayalinizdeki yatı hayata geçirmenize yardımcı olmaktan heyecan duyuyoruz. Bize info@troyyachting.com adresinden e-posta ile ulaşın veya tersanemizde bizi ziyaret edin.",
    "footer_copyright": "© 2025 Troy Yachting — tüm hakları saklıdır."
  },
  "ar": {
    "html_lang": "ar",
    "title": "تروي لليخوت — تصنيع اليخوت والخدمات البحرية",
    "meta_description": "تقدم تروي لليخوت خدمات تصنيع اليخوت الفاخرة والخدمات البحرية الشاملة. نحن هنا لتصميم وبناء يخت أحلامك.",
    "og_description": "تصنيع اليخوت الفاخرة والخدمات البحرية الشاملة.",
    "skip_link": "تجاوز إلى المحتوى الرئيسي",
    "logo_aria": "الصفحة الرئيسية لتروي لليخوت",
    "lang_select_label": "اختر اللغة",
    "nav_about": "من نحن",
    "nav_dreams": "أحلامنا",
    "nav_contact": "اتصل بنا",
    "card_manufacturing": "تصنيع اليخوت",
    "card_services": "الخدمات البحرية",
    "alt_manufacturing": "يخت فاخر في حظيرة التصنيع.",
    "alt_services": "يخت حديث يبحر بسرعة في البحر.",
    "section_about_title": "من نحن",
    "section_about_content": "بفضل سنوات من الخبرة في الصناعة البحرية، تجمع تروي لليخوت بين الحرفية التقليدية والتكنولوجيا الحديثة لإنشاء يخوت لا مثيل لها. شغفنا بالبحر والتزامنا بالجودة يقود كل مشروع نقوم به.",
    "section_dreams_title": "أحلامنا",
    "section_dreams_content": "نحلم بدفع حدود تصميم وهندسة اليخوت. هدفنا هو بناء سفن ليست فاخرة وعالية الأداء فحسب، بل أيضًا مستدامة ومتناغمة مع بيئة المحيط.",
    "section_contact_title": "اتصل بنا",
    "section_contact_content": "هل أنت مستعد لبدء رحلتك؟ اتصل بنا لمناقشة رؤيتك. نحن متحمسون لمساعدتك في تحقيق يخت أحلامك. تواصل معنا عبر البريد الإلكتروني على info@troyyachting.com أو قم بزيارتنا في حوض بناء السفن الخاص بنا.",
    "footer_copyright": "© 2025 تروي لليخوت — جميع الحقوق محفوظة."
  }
};


document.addEventListener('DOMContentLoaded', () => {
    const langSelect = document.getElementById('lang-select');
    const supportedLangs = ['en', 'tr', 'ar'];
    const defaultLang = 'tr';

    const arrowIcon = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23a8b2d1'%3E%3Cpath d='M6 9.25a.75.75 0 01-.53-.22l-3-3a.75.75 0 011.06-1.06L6 7.94l2.47-2.47a.75.75 0 111.06 1.06l-3 3a.75.75 0 01-.53.22z'/%3E%3C/svg%3E";
    const iconMap = { en: 'en.png', tr: 'tr.png', ar: 'ar.png' };
    const setLangIcon = (lang) => {
        if (!langSelect) return;
        const icon = iconMap[lang];
        if (icon) {
            langSelect.style.backgroundImage = `url(${icon}), url(${arrowIcon})`;
        }
    };

    const setupNavigation = () => {
        const navLinks = document.querySelectorAll('.main-nav a[href^="#"]');
        const menuToggle = document.getElementById('menu-toggle');

        if (!menuToggle) return;

        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (menuToggle.checked) {
                    menuToggle.checked = false;
                }
            });
        });
    };

    const applyTranslations = (lang) => {
        if (!translations[lang]) {
            console.error(`Translations for '${lang}' not found.`);
            return;
        }

        const htmlEl = document.documentElement;
        htmlEl.lang = lang;
        htmlEl.dir = lang === 'ar' ? 'rtl' : 'ltr';

        if (langSelect) {
            langSelect.value = lang;
        }

        document.querySelectorAll('[data-i18n-key]').forEach(element => {
            const key = element.dataset.i18nKey;
            const attr = element.dataset.i18nAttr;
            const translation = translations[lang][key];

            if (translation) {
                if (attr) {
                    element.setAttribute(attr, translation);
                } else {
                    element.textContent = translation;
                }
            }
        });
    };

    const getInitialLanguage = () => {
        const storedLang = localStorage.getItem('lang');
        if (storedLang && supportedLangs.includes(storedLang)) {
            return storedLang;
        }
        const browserLang = navigator.language.split('-')[0];
        if (supportedLangs.includes(browserLang)) {
            return browserLang;
        }
        return defaultLang;
    };

    // Determine and set the initial language
    const initialLang = getInitialLanguage();
    applyTranslations(initialLang);
    setLangIcon(initialLang);

    // Listen for language changes
    if (langSelect) {
        langSelect.addEventListener('change', () => {
            const newLang = langSelect.value;
            localStorage.setItem('lang', newLang);
            applyTranslations(newLang);
            setLangIcon(newLang);
        });
    }

    // Setup other UI interactions
    setupNavigation();
});
